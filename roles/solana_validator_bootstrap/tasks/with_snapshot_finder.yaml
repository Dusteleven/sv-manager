---
- name: clear ledger directory
  become: yes
  become_user: "{{ solana_user }}"
  file:
    path: "{{ ledger_path }}"
    state: "{{ item }}"
    mode: '0755'
  with_items:
    - absent
    - directory
  ignore_errors: True
  tags:
    - validator.manage.restart.snapshot.finder

- name: run snapshot finder
  become: yes
  become_user: "{{ solana_user }}"
  shell: "{{ solana_home }}/solana-snapshot-finder --snapshot-path {{ snapshots_path }} -r {{ cluster_rpc_address }}"
  environment:
    PATH: "{{ env_path }}"
  ignore_errors: True
  tags:
    - validator.manage.restart.snapshot.finder